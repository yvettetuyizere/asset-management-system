### RTB Backend API Tests
### Use VS Code REST Client extension to run these tests

### Variables
@baseUrl = http://localhost:5000
@token = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjVkYWRmZjg0LTk5YWItNGU4Ny1iZTAzLTIxMzkzNWNiYjFhMCIsImVtYWlsIjoieXZldHRldHV5aXplcmVAZ21haWwuY29tIiwicm9sZSI6InNjaG9vbCIsImlhdCI6MTc2Mjk3MDIyNCwiZXhwIjoxNzYzMDU2NjI0fQ.-VzJIdD4TnFN5MnpTnIzSBKaluDi9RtvePCvZ2kMkn4
@resetToken = YOUR_RESET_TOKEN_HERE

### ============================================
### AUTHENTICATION ENDPOINTS
### ============================================

### 1. Health Check
GET {{baseUrl}}/ HTTP/1.1

### 2. Register User
POST {{baseUrl}}/api/auth/register HTTP/1.1
Content-Type: application/json

{
  "fullName": "Yvette TUYIZERE",
  "username": "yvette",
  "email": "yvettetuyizere@gmail.com",
  "password": "password123",
  "phoneNumber": "0785644328",
  "gender": "Male"
}

### 3. Register Another User (for testing)
POST {{baseUrl}}/api/auth/register HTTP/1.1
Content-Type: application/json

{
  "fullName": "Jane Smith",
  "username": "janesmith",
  "email": "jane@example.com",
  "password": "password123",
  "phoneNumber": "0987654321",
  "gender": "Female"
}

### 4. Login with Email
POST {{baseUrl}}/api/auth/login HTTP/1.1
Content-Type: application/json

{
  "emailOrUsername": "john@example.com",
  "password": "password123"
}

### 5. Login with Username
POST {{baseUrl}}/api/auth/login HTTP/1.1
Content-Type: application/json

{
  "emailOrUsername": "yvette",
  "password": "password123"
}
### now otp verification is required
POST {{baseUrl}}/api/auth/verify-otp
Content-Type: application/json

{
  "emailOrUsername": "yvettetuyizere@gmail.com",
  "otp": "478538"
}

### 6. Login with Invalid Credentials
POST {{baseUrl}}/api/auth/login HTTP/1.1
Content-Type: application/json

{
  "emailOrUsername": "john@example.com",
  "password": "wrongpassword"
}

### 7. Forgot Password
POST {{baseUrl}}/api/auth/forgot-password HTTP/1.1
Content-Type: application/json

{
  "email": "john@example.com"
}

### 8. Reset Password
POST {{baseUrl}}/api/auth/reset-password HTTP/1.1
Content-Type: application/json

{
  "token": "{{resetToken}}",
  "newPassword": "newpassword123"
}

### ============================================
### PROFILE ENDPOINTS (Require Authentication)
### ============================================

### 9. Get Profile
GET {{baseUrl}}/api/profile HTTP/1.1
Authorization: Bearer {{token}}

### 10. Update Profile
PUT {{baseUrl}}/api/profile HTTP/1.1
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "fullName": "John Updated Doe",
  "phoneNumber": "1111111111",
  "gender": "Male"
}

### 11. Update Profile - Change Email
PUT {{baseUrl}}/api/profile HTTP/1.1
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "email": "johnupdated@example.com"
}

### 12. Update Profile - Change Username
PUT {{baseUrl}}/api/profile HTTP/1.1
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "username": "johndoeupdated"
}

### 13. Change Password
PUT {{baseUrl}}/api/profile/password HTTP/1.1
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "currentPassword": "password123",
  "newPassword": "newpassword123"
}

### 14. Change Password - Wrong Current Password
PUT {{baseUrl}}/api/profile/password HTTP/1.1
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "currentPassword": "wrongpassword",
  "newPassword": "newpassword123"
}

###

POST {{baseUrl}}/api/profile/picture HTTP/1.1
Authorization: Bearer {{token}}
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW

------WebKitFormBoundary7MA4YWxkTrZu0gW
Content-Disposition: form-data; name="profilePicture"; filename="profile.jpg"
Content-Type: image/jpeg

-

### 16. Delete Profile Picture
DELETE {{baseUrl}}/api/profile/picture HTTP/1.1
Authorization: Bearer {{token}}

### ============================================
### ERROR CASES & VALIDATION TESTS
### ============================================

### 17. Register with Invalid Email
POST {{baseUrl}}/api/auth/register HTTP/1.1
Content-Type: application/json

{
  "fullName": "John Doe",
  "username": "johndoe",
  "email": "john@example.com",
  "password": "password123",
  "phoneNumber": "1234567890",
  "gender": "Male"
}

### 18. Register with Short Password
POST {{baseUrl}}/api/auth/register HTTP/1.1
Content-Type: application/json

{
  "fullName": "Test User",
  "username": "testuser",
  "email": "test@example.com",
  "password": "123",
  "phoneNumber": "1234567890"
}

### 19. Register with Invalid Phone Number
POST {{baseUrl}}/api/auth/register HTTP/1.1
Content-Type: application/json

{
  "fullName": "Test User",
  "username": "testuser",
  "email": "test@example.com",
  "password": "password123",
  "phoneNumber": "abc"
}

### 20. Register with Duplicate Email
POST {{baseUrl}}/api/auth/register HTTP/1.1
Content-Type: application/json

{
  "fullName": "Duplicate User",
  "username": "duplicateuser",
  "email": "john@example.com",
  "password": "password123",
  "phoneNumber": "5555555555"
}

### 21. Register with Duplicate Username
POST {{baseUrl}}/api/auth/register HTTP/1.1
Content-Type: application/json

{
  "fullName": "Duplicate User",
  "username": "johndoe",
  "email": "duplicate@example.com",
  "password": "password123",
  "phoneNumber": "5555555555"
}

### 22. Access Profile without Token
GET {{baseUrl}}/api/profile HTTP/1.1

### 23. Access Profile with Invalid Token
GET {{baseUrl}}/api/profile HTTP/1.1
Authorization: Bearer invalid_token_here

### 24. Update Profile without Token
PUT {{baseUrl}}/api/profile HTTP/1.1
Content-Type: application/json

{
  "fullName": "Should Fail"
}

### ============================================
### INSTRUCTIONS
### ============================================

# How to use this file:
# 
# 1. Install the "REST Client" extension in VS Code
# 2. Start your backend server: npm run dev
# 3. Click "Send Request" above each request to test
#
# Workflow for testing:
# 1. Run request #2 (Register User) - Copy the token from response
# 2. Replace {{token}} variable at top with your actual token
# 3. Run request #4 (Login) - Verify you can login
# 4. Run request #9 (Get Profile) - Should work with valid token
# 5. Run other profile endpoints (#10-16)
# 6. Test error cases (#17-24)
#
# For forgot/reset password:
# 1. Run request #7 (Forgot Password)
# 2. Check email or server logs for reset token
# 3. Replace {{resetToken}} variable with actual token
# 4. Run request #8 (Reset Password)
#
# For file upload (#15):
# - Use Postman, Insomnia, or cURL instead
# - Or update the file path in the request

### ============================================
### CURL COMMANDS (Alternative)
### ============================================

# Register
# curl -X POST http://localhost:5000/api/auth/register \
#   -H "Content-Type: application/json" \
#   -d '{"fullName":"John Doe","username":"johndoe","email":"john@example.com","password":"password123","phoneNumber":"1234567890"}'

# Login
# curl -X POST http://localhost:5000/api/auth/login \
#   -H "Content-Type: application/json" \
#   -d '{"emailOrUsername":"john@example.com","password":"password123"}'

# Get Profile
# curl -X GET http://localhost:5000/api/profile \
#   -H "Authorization: Bearer YOUR_TOKEN"

# Upload Profile Picture
# curl -X POST http://localhost:5000/api/profile/picture \
#   -H "Authorization: Bearer YOUR_TOKEN" \
#   -F "profilePicture=@/path/to/image.jpg"
